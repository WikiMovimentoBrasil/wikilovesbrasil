const wm_map=L.tileLayer("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",{maxZoom:19,minZoom:1,attribution:credits_wikimedia}),blueIcon=L.AwesomeMarkers.icon({icon:"fa-solid fa-landmark",markerColor:"darkblue",iconColor:"white",prefix:"fas"});let map=L.map("map",{layers:[wm_map]}).setMaxBounds(bounds),marker=L.marker({lat:-90,lon:0},{icon:blueIcon,draggable:!0}),toggleMarker=!1;function postCoordinates(){var a=$("#addCoordinates"),t=a.data("item"),l=a.data("lat"),e=a.data("lon");$.ajax({url:"/postCoordinates",type:"POST",data:JSON.stringify({item:t,lat:l,lon:e}),contentType:"application/json",dataType:"json",success:function(a){$("#"+a.qid+"_row").css("background-color","#B2FF54"),alert(a.message)},error:function(a){alert('{{ _("Erro") }}')}})}$("td button").click(function(){$("#addModal").modal("show"),$("#addCoordinates").data("item",this.dataset.item),$("#monument").html(this.dataset.label),$("#local").html(this.dataset.local+"<br>"),$("#address").html(this.dataset.address+"<br>")}),$("#addModal").on("shown.bs.modal",function(){map.invalidateSize(),map.fitBounds(bounds)}),$("#addModal").on("hidden.bs.modal",function(){marker.setLatLng({lat:-90,lon:0}),map.removeLayer(marker),localizar.state("locate"),localizar.button.style.backgroundColor="#007bff",$("#addCoordinates").prop("disabled",!0),$("#latlng").val("").prop("disabled",!1),$("#latlngConfirm").prop("disabled",!1)}),$(document).ready(function(){$("#localFilter").on("keyup",function(){var a=$(this).val().toLowerCase();$("#monuments_table tr").filter(function(){$(this).toggle($(this).find("td:nth-child(2) a:nth-child(3)").text().toLowerCase().indexOf(a)>-1)})})}),$("#latlngConfirm").on("click",function(){$(this).toggleClass("cancel"),$(this).find("i").toggleClass("fa fa-solid fa-xmark");let a=0,t=0;if(toggleMarker=!toggleMarker){let l=$("#latlng").val().replace(/\s+/g,""),e=RegExp("(\\d+)(\xba|\xb0)(\\d+)'(.*)\"(N|S)(\\d+)(\xba|\xb0)(\\d+)'(.*)\"(W|E|L|O)"),o=RegExp("(.*),(.*)");if(e.test(l)){let n=e.exec(l),r=-1,i=-1;"N"===n[5]&&(r=1),("E"===n[10]||"L"===n[10])&&(i=1),a=r*(parseFloat(n[1])+parseFloat(n[3])/60+parseFloat(n[4])/3600),t=i*(parseFloat(n[6])+parseFloat(n[8])/60+parseFloat(n[9])/3600)}else if(o.test(l)){let d=o.exec(l);a=d[1],t=d[2]}var s=new L.LatLng(a,t);marker.setLatLng(s).addTo(map);var c=$("#addCoordinates");c.data("lat",a),c.data("lon",t),c[0].toggleAttribute("disabled"),$(".easy-button-button.leaflet-bar-part.leaflet-interactive").prop("disabled",!0)}else{let m=new L.LatLng(a,t);marker.setLatLng(m),map.removeLayer(marker),$(".easy-button-button.leaflet-bar-part.leaflet-interactive").prop("disabled",!1)}});const locate=L.control.locate({flyTo:!0,returnToPrevBounds:!0,icon:"locate fa-solid fa-location-dot",iconElementTag:"i",strings:{title:whereAmIMsg}}).addTo(map);var localizar=L.easyButton({states:[{stateName:"locate",icon:"fa-solid fa-map-pin",title:localizeMsg,onClick:function(a,t){t.addLayer(marker),a.state("cancel"),a.button.style.backgroundColor="#990000",$("#latlng").prop("disabled",!0),$("#latlngConfirm").prop("disabled",!0),t.on("mousemove",function(a){marker.setLatLng(a.latlng),$("#latlng").val(a.latlng.lat+", "+a.latlng.lng)}),t.on("click",function(a){marker.setLatLng(a.latlng),t.off("mousemove");var l=$("#addCoordinates");l.data("lat",a.latlng.lat),l.data("lon",a.latlng.lng),l.prop("disabled",!1),$("#latlng").val(a.latlng.lat+", "+a.latlng.lng),$("#latlngConfirm").val(a.latlng.lat+", "+a.latlng.lng)})}},{stateName:"cancel",icon:"fa-solid fa-xmark",title:cancelMsg,onClick:function(a,t){marker.setLatLng([-90,0]),t.removeLayer(marker),a.state("locate"),a.button.style.backgroundColor="#007bff",t.off("click"),$("#addCoordinates").prop("disabled",!0),$("#latlng").prop("disabled",!1),$("#latlngConfirm").prop("disabled",!1)}}]}).addTo(map);let fullScreen=new L.Control.Fullscreen({title:{false:fullScreenFalse,true:fullScreenTrue}}).addTo(map);localizar.button.style.backgroundColor="#007bff",localizar.button.style.color="#FFFFFF";